/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@getalby/sdk@3.4.0/dist/index.modern.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e = NostrTools.generatePrivateKey,
    t = NostrTools.relayInit,
    n = NostrTools.nip19,
    s = NostrTools.getPublicKey,
    r = NostrTools.finishEvent,
    i = NostrTools.getEventHash,
    o = NostrTools.nip04;
/*import{generatePrivateKey as e,relayInit as t,nip19 as n,getPublicKey as s,finishEvent as r,getEventHash as i,nip04 as o}from"/npm/nostr-tools@1.17.0/+esm";*/function a(){}function c(){c.init.call(this)}function l(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function u(e,t,n,s){var r,i,o,c;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),o=i[t]):(i=e._events=new a,e._eventsCount=0),o){if("function"==typeof o?o=i[t]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),!o.warned&&(r=l(e))&&r>0&&o.length>r){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,c=u,"function"==typeof console.warn?console.warn(c):console.log(c)}}else o=i[t]=n,++e._eventsCount;return e}function h(e,t,n){var s=!1;function r(){e.removeListener(t,r),s||(s=!0,n.apply(e,arguments))}return r.listener=n,r}function d(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function p(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},y.apply(this,arguments)}function m(e,t){if(null==e)return{};var n,s,r={},i=Object.keys(e);for(s=0;s<i.length;s++)t.indexOf(n=i[s])>=0||(r[n]=e[n]);return r}function f(e){return Object.entries(e).map((([e,t])=>e&&t?`${e}=${t}`:"")).filter((e=>e)).join("&")}function w(e,t){return`Basic ${btoa(`${e}:${t}`)}`}a.prototype=Object.create(null),c.EventEmitter=c,c.usingDomains=!1,c.prototype.domain=void 0,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.init=function(){this.domain=null,c.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new a,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return l(this)},c.prototype.emit=function(e){var t,n,s,r,i,o,a,c="error"===e;if(o=this._events)c=c&&null==o.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(n=o[e]))return!1;var u="function"==typeof n;switch(s=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var s=e.length,r=p(e,s),i=0;i<s;++i)r[i].call(n)}(n,u,this);break;case 2:!function(e,t,n,s){if(t)e.call(n,s);else for(var r=e.length,i=p(e,r),o=0;o<r;++o)i[o].call(n,s)}(n,u,this,arguments[1]);break;case 3:!function(e,t,n,s,r){if(t)e.call(n,s,r);else for(var i=e.length,o=p(e,i),a=0;a<i;++a)o[a].call(n,s,r)}(n,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,s,r,i){if(t)e.call(n,s,r,i);else for(var o=e.length,a=p(e,o),c=0;c<o;++c)a[c].call(n,s,r,i)}(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(s-1),i=1;i<s;i++)r[i-1]=arguments[i];!function(e,t,n,s){if(t)e.apply(n,s);else for(var r=e.length,i=p(e,r),o=0;o<r;++o)i[o].apply(n,s)}(n,u,this,r)}return!0},c.prototype.addListener=function(e,t){return u(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return u(this,e,t,!0)},c.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,s,r,i,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(s=this._events))return this;if(!(n=s[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new a:(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){o=n[i].listener,r=i;break}if(r<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new a,this;delete s[e]}else!function(e,t){for(var n=t,s=n+1,r=e.length;s<r;n+=1,s+=1)e[n]=e[s];e.pop()}(n,r);s.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=function(e,t){return this.removeListener(e,t)},c.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new a,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new a:delete n[e]),this;if(0===arguments.length){for(var s,r=Object.keys(n),i=0;i<r.length;++i)"removeListener"!==(s=r[i])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new a,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},c.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},c.prototype.listenerCount=d,c.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class v extends Error{constructor(e,t,n,s){let r=e.toString();t&&(r+=` ${t}`),r+=": ",r+=s.message?s.message:JSON.stringify(s),super(r),this.status=void 0,this.statusText=void 0,this.headers=void 0,this.error=void 0,this.status=e,this.statusText=t,this.headers=n,this.error=s}}var g={__proto__:null,OAuthClient:class{},AuthClient:class{},AlbyResponseError:v};const b=["auth","endpoint","params","request_body","method","max_retries","base_url","user_agent","headers"],_="https://api.getalby.com";async function k(e,t,n=0){const s=await fetch(e,t);if(429===s.status&&n>0){const r=Number(s.headers.get("x-rate-limit-reset")),i=Number(s.headers.get("x-rate-limit-remaining")),o=1e3*r-Date.now();let a=1e3;return 0===i&&(a=o),await new Promise((e=>setTimeout(e,a))),k(e,t,n-1)}return s}async function E(e){let{auth:t,endpoint:n,params:s={},request_body:r,method:i,max_retries:o,base_url:a=_,user_agent:c,headers:l}=e,u=m(e,b);const h=new URL(a+n);h.search=f(s);const d="POST"===i&&!!r,p=t?await t.getAuthHeader(h.href,i):void 0,w=await k(h.toString(),y({headers:y({},d?{"Content-Type":"application/json; charset=utf-8"}:void 0,p,l,{"User-Agent":null!=c?c:"@getalby/sdk","X-User-Agent":null!=c?c:"@getalby/sdk"}),method:i,body:d?JSON.stringify(r):void 0},u),o);if(!w.ok){const e=await w.json();throw new v(w.status,w.statusText,w.headers,e)}return w}async function P(e){return(await E(e)).json()}const T=["expires_in"],N=["token"];function A(e){const{expires_in:t}=e;return y({},m(e,T),!!t&&{expires_at:Date.now()+1e3*t})}class x{constructor(e){this.bearer_token=void 0,this.bearer_token=e}getAuthHeader(){return{Authorization:`Bearer ${this.bearer_token}`}}}var R={__proto__:null,OAuth2User:class{constructor(e){this.token=void 0,this.options=void 0,this.code_verifier=void 0,this.code_challenge=void 0,this._refreshAccessTokenPromise=void 0,this._tokenEvents=void 0,this._tokenEvents=new c;const{token:t}=e,n=m(e,N);this.options=y({client_secret:""},n),this.token=t,this._refreshAccessTokenPromise=null}on(e,t){this._tokenEvents.on(e,t)}async refreshAccessToken(){var e=this;return this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=new Promise((async function(t,n){try{var s;const n=null==(s=e.token)?void 0:s.refresh_token,{client_id:r,client_secret:i,request_options:o,user_agent:a}=e.options;if(!r)throw new Error("client_id is required");if(!n)throw new Error("refresh_token is required");const c=A(await P(y({},o,{endpoint:"/oauth/token",params:{client_id:r,grant_type:"refresh_token",refresh_token:n},user_agent:a,method:"POST",headers:y({},null==o?void 0:o.headers,{"Content-type":"application/x-www-form-urlencoded"},{Authorization:w(r,i)})})));e.token=c,t({token:c}),e._tokenEvents.emit("tokenRefreshed",e.token)}catch(t){console.error(t),n(t),e._tokenEvents.emit("tokenRefreshFailed",t)}finally{e._refreshAccessTokenPromise=null}}))),this._refreshAccessTokenPromise}isAccessTokenExpired(){var e,t;const n=null==(e=this.token)?void 0:e.refresh_token,s=null==(t=this.token)?void 0:t.expires_at;return!s||!!n&&s<=Date.now()+1e3}async requestAccessToken(e){const{client_id:t,client_secret:n,callback:s,request_options:r,user_agent:i}=this.options,o=this.code_verifier;if(!t)throw new Error("client_id is required");if(!n&&!o)throw new Error("either client_secret is required, or code should be generated using a challenge");if(!s)throw new Error("callback is required");const a={code:e,grant_type:"authorization_code",code_verifier:o,client_id:t,redirect_uri:s},c=A(await P(y({},r,{endpoint:"/oauth/token",params:a,user_agent:i,method:"POST",headers:y({},null==r?void 0:r.headers,{"Content-Type":"application/x-www-form-urlencoded"},{Authorization:w(t,n)})})));return this.token=c,{token:c}}async generateAuthURL(e){e||(e={});const{client_id:t,callback:n,scopes:s}=this.options;if(!n)throw new Error("callback required");if(!s)throw new Error("scopes required");let r;"S256"===e.code_challenge_method?(await this._generateS256Challenge(),r="S256"):"plain"===e.code_challenge_method&&e.code_challenge&&(this.code_challenge=e.code_challenge,this.code_verifier=e.code_challenge,r="plain");const i=this.code_challenge,o=new URL(e.authorizeUrl||"https://getalby.com/oauth");return o.search=f(y({},e,{client_id:t,scope:s.join(" "),response_type:"code",redirect_uri:n,code_challenge_method:r,code_challenge:i})),o.toString()}async getAuthHeader(){var e;if(null==(e=this.token)||!e.access_token)throw new Error("access_token is required");return this.isAccessTokenExpired()&&await this.refreshAccessToken(),{Authorization:`Bearer ${this.token.access_token}`}}async _generateS256Challenge(){const e=crypto.getRandomValues(new Uint8Array(64));this.code_verifier=e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),"");const t=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(this.code_verifier)),n=new Uint8Array(t);this.code_challenge=btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}},OAuth2Bearer:x};class q extends Error{constructor(e,t){super(e),this.error=void 0,this.code=void 0,this.error=e,this.code=t}}class L extends q{}class C extends q{}class O extends C{}class U extends C{}class I extends q{}class S extends q{}class W extends q{}class M extends q{}const $={alby:{authorizationUrl:"https://nwc.getalby.com/apps/new",relayUrl:"wss://relay.getalby.com/v1",walletPubkey:"69effe7b49a6dd5cf525bd0905917a5005ffe480b58eeb8e861418cf3ae760d9"}};class K{static parseWalletConnectUrl(e){e=e.replace("nostrwalletconnect://","http://").replace("nostr+walletconnect://","http://");const t=new URL(e),n=t.searchParams.get("relay");if(!n)throw new Error("No relay URL found in connection string");const s={walletPubkey:t.host,relayUrl:n},r=t.searchParams.get("secret");return r&&(s.secret=r),s}static withNewSecret(t){return(t=t||{}).secret=e(),new K(t)}constructor(e){var s;this.relay=void 0,this.relayUrl=void 0,this.secret=void 0,this.walletPubkey=void 0,this.options=void 0,e&&e.nostrWalletConnectUrl&&(e=y({},K.parseWalletConnectUrl(e.nostrWalletConnectUrl),e));const r=$[(null==(s=e)?void 0:s.providerName)||"alby"];this.options=y({},r,e||{}),this.relayUrl=this.options.relayUrl,this.relay=t(this.relayUrl),this.options.secret&&(this.secret=this.options.secret.toLowerCase().startsWith("nsec")?n.decode(this.options.secret).data:this.options.secret),this.walletPubkey=this.options.walletPubkey.toLowerCase().startsWith("npub")?n.decode(this.options.walletPubkey).data:this.options.walletPubkey,void 0===globalThis.WebSocket&&console.error("WebSocket is undefined. Make sure to `import websocket-polyfill` for nodejs environments")}get nostrWalletConnectUrl(){return this.getNostrWalletConnectUrl()}getNostrWalletConnectUrl(e=!0){let t=`nostr+walletconnect://${this.walletPubkey}?relay=${this.relayUrl}&pubkey=${this.publicKey}`;return e&&(t=`${t}&secret=${this.secret}`),t}get connected(){return 1===this.relay.status}get publicKey(){if(!this.secret)throw new Error("Missing secret key");return s(this.secret)}getPublicKey(){return Promise.resolve(this.publicKey)}signEvent(e){if(!this.secret)throw new Error("Missing secret key");return Promise.resolve(r(e,this.secret))}getEventHash(e){return i(e)}close(){return this.relay.close()}async encrypt(e,t){if(!this.secret)throw new Error("Missing secret");return await o.encrypt(this.secret,e,t)}async decrypt(e,t){if(!this.secret)throw new Error("Missing secret");return await o.decrypt(this.secret,e,t)}getAuthorizationUrl(e){if(!this.options.authorizationUrl)throw new Error("Missing authorizationUrl option");const t=new URL(this.options.authorizationUrl);return null!=e&&e.name&&t.searchParams.set("name",null==e?void 0:e.name),t.searchParams.set("pubkey",this.publicKey),null!=e&&e.returnTo&&t.searchParams.set("return_to",e.returnTo),null!=e&&e.budgetRenewal&&t.searchParams.set("budget_renewal",e.budgetRenewal),null!=e&&e.expiresAt&&t.searchParams.set("expires_at",Math.floor(e.expiresAt.getTime()/1e3).toString()),null!=e&&e.maxAmount&&t.searchParams.set("max_amount",e.maxAmount.toString()),void 0!==(null==e?void 0:e.editable)&&t.searchParams.set("editable",e.editable.toString()),null!=e&&e.requestMethods&&t.searchParams.set("request_methods",e.requestMethods.join(" ")),t}initNWC(e={}){e.name||(e.name=document.location.host);const t=this.getAuthorizationUrl(e),n=window.outerHeight/2+window.screenY-300,s=window.outerWidth/2+window.screenX-200;return new Promise(((e,r)=>{const i=window.open(t.toString(),`${document.title} - Wallet Connect`,`height=600,width=400,top=${n},left=${s}`);if(!i)return void r(new Error("failed to execute window.open"));const o=n=>{const s=n.data;s&&"nwc:success"===s.type&&n.origin===`${t.protocol}//${t.host}`&&(e(s),clearInterval(a),window.removeEventListener("message",o),i&&i.close())},a=setInterval((()=>{i&&i.closed&&(clearInterval(a),window.removeEventListener("message",o),r(new Error("Popup closed")))}),500);window.addEventListener("message",o)}))}async getWalletServiceSupportedMethods(){await this._checkConnected();const e=await this.relay.list([{kinds:[13194],limit:1,authors:[this.walletPubkey]}],{eoseSubTimeout:1e4});if(!e.length)throw new Error("no info event (kind 13194) returned from relay");return e[0].content.split(/[ |,]/g)}async getInfo(){try{return await this.executeNip47Request("get_info",{},(e=>!!e.methods))}catch(e){throw console.error("Failed to request get_info",e),e}}async getBalance(){try{return await this.executeNip47Request("get_balance",{},(e=>void 0!==e.balance))}catch(e){throw console.error("Failed to request get_balance",e),e}}async payInvoice(e){try{return await this.executeNip47Request("pay_invoice",e,(e=>!!e.preimage))}catch(e){throw console.error("Failed to request pay_invoice",e),e}}async payKeysend(e){try{return await this.executeNip47Request("pay_keysend",e,(e=>!!e.preimage))}catch(e){throw console.error("Failed to request pay_keysend",e),e}}async multiPayInvoice(e){try{return{invoices:await this.executeMultiNip47Request("multi_pay_invoice",e,e.invoices.length,(e=>!!e.preimage)),errors:[]}}catch(e){throw console.error("Failed to request multi_pay_invoice",e),e}}async multiPayKeysend(e){try{return{keysends:await this.executeMultiNip47Request("multi_pay_keysend",e,e.keysends.length,(e=>!!e.preimage)),errors:[]}}catch(e){throw console.error("Failed to request multi_pay_keysend",e),e}}async makeInvoice(e){try{if(!e.amount)throw new Error("No amount specified");return await this.executeNip47Request("make_invoice",e,(e=>!!e.invoice))}catch(e){throw console.error("Failed to request make_invoice",e),e}}async lookupInvoice(e){try{return await this.executeNip47Request("lookup_invoice",e,(e=>!!e.invoice))}catch(e){throw console.error("Failed to request lookup_invoice",e),e}}async listTransactions(e){try{return await this.executeNip47Request("list_transactions",e,(e=>!!e.transactions))}catch(e){throw console.error("Failed to request list_transactions",e),e}}async executeNip47Request(e,t,n){var s=this;return await this._checkConnected(),new Promise(((r,i)=>{!async function(){const o={method:e,params:t},a=await s.encrypt(s.walletPubkey,JSON.stringify(o)),c={kind:23194,created_at:Math.floor(Date.now()/1e3),tags:[["p",s.walletPubkey]],content:a,pubkey:s.publicKey},l=await s.signEvent(c),u=s.relay.sub([{kinds:[23195],authors:[s.walletPubkey],"#e":[l.id]}]),h=setTimeout((function(){u.unsub(),i(new U(`reply timeout: event ${l.id}`,"INTERNAL"))}),6e4);u.on("event",(async function(e){clearTimeout(h),u.unsub();const t=await s.decrypt(s.walletPubkey,e.content);let o;try{o=JSON.parse(t)}catch(e){return clearTimeout(h),u.unsub(),void i(new S("failed to deserialize response","INTERNAL"))}var a,c,l,d;23195==e.kind?o.result?n(o.result)?r(o.result):(clearTimeout(h),u.unsub(),i(new W("response from NWC failed validation: "+JSON.stringify(o.result),"INTERNAL"))):(clearTimeout(h),u.unsub(),i(new L((null==(a=o.error)?void 0:a.message)||"unknown Error",(null==(c=o.error)?void 0:c.code)||"INTERNAL"))):(clearTimeout(h),u.unsub(),i(new M((null==(l=o.error)?void 0:l.message)||"unknown Error",(null==(d=o.error)?void 0:d.code)||"INTERNAL")))}));const d=setTimeout((function(){u.unsub(),i(new O(`publish timeout: ${l.id}`,"INTERNAL"))}),5e3);try{await s.relay.publish(l),clearTimeout(d)}catch(e){clearTimeout(d),i(new I(`failed to publish: ${e}`,"INTERNAL"))}}()}))}async executeMultiNip47Request(e,t,n,s){var r=this;await this._checkConnected();const i=[];return new Promise(((o,a)=>{!async function(){const c={method:e,params:t},l=await r.encrypt(r.walletPubkey,JSON.stringify(c)),u={kind:23194,created_at:Math.floor(Date.now()/1e3),tags:[["p",r.walletPubkey]],content:l,pubkey:r.publicKey},h=await r.signEvent(u),d=r.relay.sub([{kinds:[23195],authors:[r.walletPubkey],"#e":[h.id]}]),p=setTimeout((function(){d.unsub(),a(new U(`reply timeout: event ${h.id}`,"INTERNAL"))}),6e4);d.on("event",(async function(e){const t=await r.decrypt(r.walletPubkey,e.content);let c;try{c=JSON.parse(t)}catch(e){clearTimeout(p),d.unsub(),a(new S("failed to deserialize response","INTERNAL"))}var l,u;if(23195==e.kind)if(c.result){var h;if(!s(c.result))return clearTimeout(p),d.unsub(),void a(new W("Response from NWC failed validation: "+JSON.stringify(c.result),"INTERNAL"));const t=null==(h=e.tags.find((e=>"d"===e[0])))?void 0:h[1];if(void 0===t)return clearTimeout(p),d.unsub(),void a(new W("No d tag found in response event","INTERNAL"));i.push(y({},c.result,{dTag:t})),i.length===n&&(clearTimeout(p),d.unsub(),o(i))}else{var m,f;clearTimeout(p),d.unsub(),a(new L(null==(m=c.error)?void 0:m.message,null==(f=c.error)?void 0:f.code))}else clearTimeout(p),d.unsub(),a(new M(null==(l=c.error)?void 0:l.message,null==(u=c.error)?void 0:u.code))}));const m=setTimeout((function(){d.unsub(),a(new O(`Publish timeout: ${h.id}`,"INTERNAL"))}),5e3);try{await r.relay.publish(h),clearTimeout(m)}catch(e){clearTimeout(m),a(new I(`Failed to publish: ${e}`,"INTERNAL"))}}()}))}async _checkConnected(){if(!this.secret)throw new Error("Missing secret key");await this.relay.connect()}}var z={__proto__:null,Nip47Error:q,Nip47WalletError:L,Nip47TimeoutError:C,Nip47PublishTimeoutError:O,Nip47ReplyTimeoutError:U,Nip47PublishError:I,Nip47ResponseDecodingError:S,Nip47ResponseValidationError:W,Nip47UnexpectedResponseError:M,NWCs:$,NWCClient:K};const j={get_info:"getInfo",get_balance:"getBalance",make_invoice:"makeInvoice",pay_invoice:"sendPayment",pay_keysend:"payKeysend",lookup_invoice:"lookupInvoice",list_transactions:"listTransactions",multi_pay_invoice:"sendMultiPayment",multi_pay_keysend:"multiKeysend"};class B{get relay(){return console.warn("relay is deprecated. Please use client.relay instead."),this.client.relay}get relayUrl(){return console.warn("relayUrl is deprecated. Please use client.relayUrl instead."),this.client.relayUrl}get walletPubkey(){return console.warn("walletPubkey is deprecated. Please use client.walletPubkey instead."),this.client.walletPubkey}get options(){return this.client.options}get secret(){return console.warn("secret is deprecated. Please use client.secret instead."),this.client.secret}static withNewSecret(t){return(t=t||{}).secret=e(),new B(t)}constructor(e){this._enabled=!1,this.client=void 0,this.subscribers=void 0,this.client=new K(e),this.subscribers={}}on(e,t){this.subscribers[e]=t}notify(e,t){const n=this.subscribers[e];n&&n(t)}getNostrWalletConnectUrl(e=!0){return console.warn("getNostrWalletConnectUrl is deprecated. Please use client.getNostrWalletConnectUrl instead."),this.client.getNostrWalletConnectUrl(e)}get nostrWalletConnectUrl(){return console.warn("nostrWalletConnectUrl is deprecated. Please use client.nostrWalletConnectUrl instead."),this.client.nostrWalletConnectUrl}get connected(){return console.warn("connected is deprecated. Please use client.connected instead."),this.client.connected}get publicKey(){return console.warn("publicKey is deprecated. Please use client.publicKey instead."),this.client.publicKey}getPublicKey(){return this.client.getPublicKey()}signEvent(e){return this.client.signEvent(e)}getEventHash(e){return console.warn("getEventHash is deprecated. Please use client.getEventHash instead."),this.client.getEventHash(e)}async enable(){this._enabled=!0}close(){return this.client.close()}async encrypt(e,t){return console.warn("encrypt is deprecated. Please use client.encrypt instead."),this.client.encrypt(e,t)}async decrypt(e,t){return console.warn("decrypt is deprecated. Please use client.decrypt instead."),this.client.decrypt(e,t)}getAuthorizationUrl(e){return console.warn("getAuthorizationUrl is deprecated. Please use client.getAuthorizationUrl instead."),this.client.getAuthorizationUrl(e)}initNWC(e={}){return console.warn("initNWC is deprecated. Please use client.initNWC instead."),this.client.initNWC(e)}async getInfo(){await this.checkEnabled();const e=["lightning","nostr"],t="Alby JS SDK";try{const n=await this.client.getInfo(),s={methods:n.methods.map((e=>j[e])),node:{alias:n.alias,pubkey:n.pubkey,color:n.color},supports:e,version:t};return this.notify("getInfo",s),s}catch(n){return console.error("Using minimal getInfo",n),{methods:["sendPayment"],node:{},supports:e,version:t}}}async getBalance(){await this.checkEnabled();const e=await this.client.getBalance(),t={balance:Math.floor(e.balance/1e3),currency:"sats"};return this.notify("getBalance",t),t}async sendPayment(e){await this.checkEnabled();const t={preimage:(await this.client.payInvoice({invoice:e})).preimage};return this.notify("sendPayment",t),t}async sendPaymentAsync(e){return await this.checkEnabled(),this.client.payInvoice({invoice:e}),this.notify("sendPaymentAsync",{}),{}}async keysend(e){await this.checkEnabled();const t={preimage:(await this.client.payKeysend(F(e))).preimage};return this.notify("keysend",t),t}async makeInvoice(e){var t;await this.checkEnabled();const n="object"==typeof e?e:void 0,s=+(null!=(t=null==n?void 0:n.amount)?t:e);if(!s)throw new Error("No amount specified");const r={paymentRequest:(await this.client.makeInvoice({amount:1e3*s,description:null==n?void 0:n.defaultMemo})).invoice};return this.notify("makeInvoice",r),r}async lookupInvoice(e){await this.checkEnabled();const t=await this.client.lookupInvoice({invoice:e.paymentRequest,payment_hash:e.paymentHash}),n={preimage:t.preimage,paymentRequest:t.invoice,paid:!!t.settled_at};return this.notify("lookupInvoice",n),n}async listTransactions(e){await this.checkEnabled();const t={transactions:(await this.client.listTransactions(e)).transactions.map(H)};return this.notify("listTransactions",t),t}async sendMultiPayment(e){await this.checkEnabled();const t={payments:(await this.client.multiPayInvoice({invoices:e.map(((e,t)=>({invoice:e,id:t.toString()})))})).invoices.map((t=>{const n=e[parseInt(t.dTag)];if(!n)throw new Error("Could not find paymentRequest matching response d tag");return{paymentRequest:n,preimage:t.preimage}})),errors:[]};return this.notify("sendMultiPayment",t),t}async multiKeysend(e){await this.checkEnabled();const t={keysends:(await this.client.multiPayKeysend({keysends:e.map(((e,t)=>y({},F(e),{id:t.toString()})))})).keysends.map((t=>{const n=e[parseInt(t.dTag)];if(!n)throw new Error("Could not find keysend matching response d tag");return{keysend:n,preimage:t.preimage}})),errors:[]};return this.notify("multiKeysend",t),t}lnurl(e){throw new Error("Method not implemented.")}request(e,t){throw new Error("Method not implemented.")}signMessage(e){throw new Error("Method not implemented.")}verifyMessage(e,t){throw new Error("Method not implemented.")}async checkEnabled(){if(!this._enabled)throw new Error("please call enable() and await the promise before calling this function")}}function H(e){return y({},e,{amount:Math.floor(e.amount/1e3),fees_paid:e.fees_paid?Math.floor(e.fees_paid/1e3):0})}function F(e){return{amount:1e3*+e.amount,pubkey:e.destination,tlv_records:e.customRecords?Object.entries(e.customRecords).map((e=>({type:parseInt(e[0]),value:e[1]}))):[]}}const D=B;function G(e){const t={};return e.recipient.customKey&&e.recipient.customValue&&(t[e.recipient.customKey]=e.recipient.customValue),t[7629169]=JSON.stringify(e.boostagram),{destination:e.recipient.address,amount:e.amount,customRecords:t}}class J{constructor(e,t){this.auth=void 0,this.defaultRequestOptions=void 0,this.auth="string"==typeof e?new x(e):e,this.defaultRequestOptions=y({},t,{user_agent:null==t?void 0:t.user_agent})}accountBalance(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/balance",params:e,method:"GET"}))}accountSummary(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/user/summary",params:e,method:"GET"}))}accountInformation(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/user/me",params:e,method:"GET"}))}accountValue4Value(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/user/value4value",params:e,method:"GET"}))}incomingInvoices(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices/incoming",params:e,method:"GET"}))}outgoingInvoices(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices/outgoing",params:e,method:"GET"}))}invoices(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices",params:e,method:"GET"}))}getInvoice(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:`/invoices/${e}`,method:"GET"}))}decodeInvoice(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:`/decode/bolt11/${e}`,method:"GET"}))}createInvoice(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/invoices",request_body:e,method:"POST"}))}keysend(e,t){let n,s;return Array.isArray(e)?(n="/payments/keysend/multi",s={keysends:e}):(n="/payments/keysend",s=e),P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:n,request_body:s,method:"POST"}))}sendPayment(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/payments/bolt11",request_body:e,method:"POST"}))}sendBoostagram(e,t){let n,s;return Array.isArray(e)?(n="/payments/keysend/multi",s={keysends:e.map((e=>G(e)))}):(n="/payments/keysend",s=G(e)),P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:n,request_body:s,method:"POST"}))}sendToAlbyAccount(e,t){return console.warn("sendToAlbyAccount is deprecated. Please use sendBoostagramToAlbyAccount instead."),this.sendBoostagramToAlbyAccount(e,t)}sendBoostagramToAlbyAccount(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/payments/keysend",request_body:{destination:"030a58b8653d32b99200a2334cfe913e51dc7d155aa0116c176657a4f1722677a3",customRecords:{696969:e.account},amount:e.amount,memo:e.memo},method:"POST"}))}createWebhookEndpoint(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/webhook_endpoints",request_body:e,method:"POST"}))}deleteWebhookEndpoint(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:`/webhook_endpoints/${e}`,method:"DELETE"}))}getSwapInfo(e){return P(y({auth:this.auth},this.defaultRequestOptions,e,{endpoint:"/swaps/info",method:"GET"}))}createSwap(e,t){return P(y({auth:this.auth},this.defaultRequestOptions,t,{endpoint:"/swaps",method:"POST",request_body:e}))}}var V={__proto__:null,NostrWebLNProvider:B,NWC:D,OauthWeblnProvider:class{constructor(e){this.client=void 0,this.auth=void 0,this.oauth=void 0,this.subscribers=void 0,this.isExecuting=void 0,this.auth=e.auth,this.client=new J(e.auth),this.oauth=!0,this.subscribers={},this.isExecuting=!1}on(e,t){this.subscribers[e]=t}notify(e,t){const n=this.subscribers[e];n&&n(t)}async enable(){var e;if(!this.isExecuting){if(null!=(e=this.auth.token)&&e.access_token)return{enabled:!0};if("undefined"==typeof window||void 0===window.document)throw new Error("Missing access token");try{this.isExecuting=!0,await this.openAuthorization()}finally{this.isExecuting=!1}}}async sendPayment(e){if(!this.isExecuting)try{this.isExecuting=!0;const t=await this.client.sendPayment({invoice:e});return this.notify("sendPayment",t),{preimage:t.payment_preimage}}catch(e){let t="Unknown Error";throw e instanceof Error&&(t=e.message),new Error(t)}finally{this.isExecuting=!1}}async keysend(e){if(!this.isExecuting)try{this.isExecuting=!0;const t=await this.client.keysend(e);return this.notify("keysend",t),{preimage:t.payment_preimage}}catch(e){let t="Unknown Error";throw e instanceof Error&&(t=e.message),new Error(t)}finally{this.isExecuting=!1}}async getInfo(){return{alias:"Alby"}}async makeInvoice(e){if(!this.isExecuting)try{this.isExecuting=!0;const t=await this.client.createInvoice({amount:parseInt(e.amount.toString()),description:e.defaultMemo});return this.notify("makeInvoice",t),{paymentRequest:t.payment_request}}catch(e){let t="Unknown Error";throw e instanceof Error&&(t=e.message),new Error(t)}finally{this.isExecuting=!1}}async openAuthorization(){var e=this;const t=window.outerHeight/2+window.screenY-350,n=window.outerWidth/2+window.screenX-300,s=await this.auth.generateAuthURL({code_challenge_method:"S256"});return new Promise(((r,i)=>{const o=window.open(s,`${document.title} - WebLN enable`,`height=700,width=600,top=${t},left=${n}`);let a=!1;window.addEventListener("message",(async function(t){const n=t.data;if(n&&"alby:oauth:success"===n.type&&t.origin===`${document.location.protocol}//${document.location.host}`&&!a){a=!0,console.info("Processing OAuth code response");const t=n.payload.code;try{await e.auth.requestAccessToken(t),e.client=new J(e.auth),o&&o.close(),e.notify("enable"),r({enabled:!0})}catch(e){console.error(e),i({enabled:!1})}}}))}))}}};export{J as Client,R as auth,z as nwc,g as types,V as webln};export default null;
//# sourceMappingURL=/sm/cd626584c02471126140ae3bac1035e35db406c3e9c71184101e573081c3a0ef.map
